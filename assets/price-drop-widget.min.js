var PriceDropWidget=(()=>{var h=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var y=h(()=>{var l=()=>{let o="https://price-drop-notifier-server.vercel.app",t=window.userscript_product,c=document.getElementById("price-drop-widget-root");if(!c)return;c.innerHTML=`
      <div class="form-container">
  <div id="price-drop-form" class="static-form">
    <h3 class="form-title">Email me if this product gets cheaper</h3>
    <input id="widget_email" type="email" name="widget_email" placeholder="you@example.com" required />
    <button type="button" id="price-drop-submit-btn">Notify me</button>

    <p id="price-drop-error-msg" class="error pd-hidden" >Something went wrong</p>
    <p id="price-drop-success-msg" class="success pd-hidden" >You will be notified!</p>
    <div id="price-drop-loading" class="loading pd-hidden" ></div>
  </div>
</div>
    `;let m=document.getElementById("price-drop-form"),f=document.getElementById("price-drop-submit-btn"),e=document.getElementById("price-drop-error-msg"),r=document.getElementById("price-drop-success-msg"),a=document.getElementById("price-drop-loading"),d=document.createElement("input");d.type="hidden",d.name="userscript_product",d.id="userscript_product_input",m.appendChild(d),document.addEventListener("click",async s=>{if(s.target&&s.target.id==="price-drop-submit-btn"){s.preventDefault(),s.stopPropagation();let u=document.getElementById("widget_email");e.classList.contains("pd-hidden")||e.classList.add("pd-hidden"),r.classList.contains("pd-hidden")||r.classList.add("pd-hidden"),a.classList.remove("pd-hidden");let n;try{n=JSON.parse(d.value)}catch{n=t}let p=u.value.trim();console.log({widget_email:p,userscript_product:n});try{let i=await fetch(`${o}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_email:p,userscript_product:n})});if(i.ok)r.classList.remove("pd-hidden");else if(i.status===409)e.classList.contains("pd-hidden")&&e.classList.remove("pd-hidden"),e.textContent="You are already registered";else throw new Error("Server error")}catch(i){console.error("Widget Error:",i);let g=new CustomEvent("widget-failed",{detail:{reason:i.message,type:"CSP_OR_NETWORK"}});window.dispatchEvent(g),e.classList.contains("pd-hidden")&&e.classList.remove("pd-hidden"),e.textContent="Something went wrong. Please try again."}finally{a.classList.add("pd-hidden")}}},!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l()});return y();})();
