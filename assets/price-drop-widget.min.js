var PriceDropWidget=(()=>{var g=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var f=g(()=>{var a=()=>{let i="https://price-drop-notifier-server.vercel.app",e=document.getElementById("price-drop-widget-root");if(!e)return;e.innerHTML=`
      <div class="form-container">
  <div id="price-drop-form" class="static-form">
    <h3 class="form-title">Price Drop Notification</h3>
    <input id="widget_email" type="email" name="widget_email" placeholder="you@example.com" required />
    <button type="button" id="price-drop-submit-btn">Notify me</button>

    <p id="price-drop-error-msg" class="error" style="display: none;">Something went wrong</p>
    <p id="price-drop-success-msg" class="success" style="display: none;">You will be notified!</p>
    <div id="price-drop-loading" class="loading" style="display: none;"></div>
  </div>
</div>
    `;let s=document.getElementById("price-drop-form"),w=document.getElementById("price-drop-submit-btn"),r=document.getElementById("price-drop-error-msg"),d=document.getElementById("price-drop-success-msg"),c=document.getElementById("price-drop-loading"),n=document.createElement("input");n.type="hidden",n.name="userscript_product",n.id="userscript_product_input",s.appendChild(n),document.addEventListener("click",async o=>{if(o.target&&o.target.id==="price-drop-submit-btn"){o.preventDefault(),o.stopPropagation();let u=document.getElementById("widget_email");r.style.display="none",d.style.display="none",c.style.display="block";let m=new FormData(o.target),l=u.value.trim(),p=m.get("userscript_product")||{name:document.querySelector("#productTitle")?.innerText.trim(),price:document.querySelector(".a-price .a-offscreen")?.innerText,url:window.location.href};console.log({widget_email:l,userscript_product:p});try{let t=await fetch(`${i}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,userscript_product:p})});if(t.ok)d.style.display="block",s.reset();else if(t.status===409)r.style.display="block",r.textContent="You are already registered";else throw new Error("Server error")}catch(t){console.error("Widget Error:",t);let y=new CustomEvent("widget-failed",{detail:{reason:t.message,type:"CSP_OR_NETWORK"}});window.dispatchEvent(y),console.error("Widget Error:",t),r.style.display="block",r.textContent="Something went wrong. Please try again."}finally{c.style.display="none"}}},!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a()});return f();})();
