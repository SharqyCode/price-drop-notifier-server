var PriceDropWidget=(()=>{var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var E=f(()=>{var m=()=>{let n="https://price-drop-notifier-server.vercel.app",e=window.priceDropProductData,d=document.getElementById("price-drop-widget-root");if(!d)return;d.innerHTML=`
      <div class="form-container">
  <div id="price-drop-form" class="static-form">
    <h3 class="form-title">Price Drop Notification</h3>
    <input id="widget_email" type="email" name="widget_email" placeholder="you@example.com" required />
    <button type="button" id="price-drop-submit-btn">Notify me</button>

    <p id="price-drop-error-msg" class="error" style="display: none;">Something went wrong</p>
    <p id="price-drop-success-msg" class="success" style="display: none;">You will be notified!</p>
    <div id="price-drop-loading" class="loading" style="display: none;"></div>
  </div>
</div>
    `;let c=document.getElementById("price-drop-form"),b=document.getElementById("price-drop-submit-btn"),o=document.getElementById("price-drop-error-msg"),p=document.getElementById("price-drop-success-msg"),a=document.getElementById("price-drop-loading"),i=document.createElement("input");i.type="hidden",i.name="userscript_product",i.id="userscript_product_input",c.appendChild(i),document.addEventListener("click",async r=>{if(r.target&&r.target.id==="price-drop-submit-btn"){r.preventDefault(),r.stopPropagation();let y=document.getElementById("widget_email");o.style.display="none",p.style.display="none",a.style.display="block";let l=new FormData(r.target),g=l.get("userscript_product"),s;try{s=JSON.parse(g)}catch{s=e}let u=y.value.trim(),h=l.get("userscript_product");console.log({widget_email:u,userscript_product:s});try{let t=await fetch(`${n}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,userscript_product:product})});if(t.ok)p.style.display="block",c.reset();else if(t.status===409)o.style.display="block",o.textContent="You are already registered";else throw new Error("Server error")}catch(t){console.error("Widget Error:",t);let w=new CustomEvent("widget-failed",{detail:{reason:t.message,type:"CSP_OR_NETWORK"}});window.dispatchEvent(w),console.error("Widget Error:",t),o.style.display="block",o.textContent="Something went wrong. Please try again."}finally{a.style.display="none"}}},!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()});return E();})();
