var PriceDropWidget=(()=>{var E=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var w=E(()=>{var u=()=>{let s="https://price-drop-notifier-server.vercel.app",e=document.getElementById("price-drop-widget-root");if(!e)return;e.innerHTML=`
      <div class="form-container">
  <form id="price-drop-form" class="static-form">
    <h3 class="form-title">Price Drop Notification</h3>
    <input type="email" name="widget_email" placeholder="you@example.com" required />
    <button type="submit">Notify me</button>

    <p id="price-drop-error-msg" class="error" style="display: none;">Something went wrong</p>
    <p id="price-drop-success-msg" class="success" style="display: none;">You will be notified!</p>
    <div id="price-drop-loading" class="loading" style="display: none;"></div>
  </form>
</div>
    `;let d=document.getElementById("price-drop-toggle-btn"),g=document.getElementById("price-drop-toggle-text"),y=document.getElementById("price-drop-panel"),c=document.getElementById("price-drop-form"),n=document.getElementById("price-drop-error-msg"),p=document.getElementById("price-drop-success-msg"),a=document.getElementById("price-drop-loading"),i=document.createElement("input");i.type="hidden",i.name="userscript_product",i.id="userscript_product_input",c.appendChild(i),d.addEventListener("click",()=>{let o=!(d.getAttribute("aria-expanded")==="true");d.setAttribute("aria-expanded",o),g.textContent=o?"Hide":"Email me if this product gets cheaper",y.classList.toggle("open",o)}),document.addEventListener("submit",async t=>{if(t.target&&t.target.id==="price-drop-form"){t.preventDefault(),t.stopPropagation(),n.style.display="none",p.style.display="none",a.style.display="block";let o=new FormData(t.target),l=o.get("widget_email"),m=o.get("userscript_product")||{name:document.querySelector("#productTitle")?.innerText.trim(),price:document.querySelector(".a-price .a-offscreen")?.innerText,url:window.location.href};console.log({widget_email:l,userscript_product:m});try{let r=await fetch(`${s}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,userscript_product:m})});if(r.ok)p.style.display="block",c.reset();else if(r.status===409)n.style.display="block",n.textContent="You are already registered";else throw new Error("Server error")}catch(r){console.error("Widget Error:",r);let f=new CustomEvent("widget-failed",{detail:{reason:r.message,type:"CSP_OR_NETWORK"}});window.dispatchEvent(f),console.error("Widget Error:",r),n.style.display="block",n.textContent="Something went wrong. Please try again."}finally{a.style.display="none"}}},!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()});return w();})();
