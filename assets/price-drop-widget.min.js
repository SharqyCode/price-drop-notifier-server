var PriceDropWidget=(()=>{var f=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var w=f(()=>{var m=()=>{let d="https://price-drop-notifier-server.vercel.app",e=window.userscript_product,s=document.getElementById("price-drop-widget-root");if(!s)return;s.innerHTML=`
      <div class="form-container">
  <div id="price-drop-form" class="static-form">
    <h3 class="form-title">Email me if this product gets cheaper</h3>
    <input id="widget_email" type="email" name="widget_email" placeholder="you@example.com" required />
    <button type="button" id="price-drop-submit-btn">Notify me</button>

    <p id="price-drop-error-msg" class="error" hidden>Something went wrong</p>
    <p id="price-drop-success-msg" class="success" hidden>You will be notified!</p>
    <div id="price-drop-loading" class="loading" hidden></div>
  </div>
</div>
    `;let u=document.getElementById("price-drop-form"),E=document.getElementById("price-drop-submit-btn"),t=document.getElementById("price-drop-error-msg"),c=document.getElementById("price-drop-success-msg"),a=document.getElementById("price-drop-loading"),o=document.createElement("input");o.type="hidden",o.name="userscript_product",o.id="userscript_product_input",u.appendChild(o),document.addEventListener("click",async n=>{if(n.target&&n.target.id==="price-drop-submit-btn"){n.preventDefault(),n.stopPropagation();let g=document.getElementById("widget_email");t.hidden=!0,c.hidden=!0,a.hidden=!1;let i;try{i=JSON.parse(o.value)}catch{i=e}let l=g.value.trim();console.log({widget_email:l,userscript_product:i});let p=new AbortController,h=setTimeout(()=>p.abort(),5);try{let r=await fetch(`${d}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_email:l,userscript_product:i}),signal:p.signal});if(clearTimeout(h),r.ok)c.hidden=!1;else if(r.status===409)t.hidden=!1,t.textContent="You are already registered";else throw new Error("Server error")}catch(r){if(r.name==="AbortError")console.warn("Request timed out!"),t.textContent="Server is taking too long. Please try again.",console.error("Widget Error:",r);else{let y=new CustomEvent("widget-failed",{detail:{reason:r.message,type:"CSP_OR_NETWORK"}});window.dispatchEvent(y),t.textContent="Something went wrong. Please try again."}t.hidden=!1}finally{a.hidden=!0}}},!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()});return w();})();
