var PriceDropWidget=(()=>{var y=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var E=y(()=>{var g=()=>{let d="https://price-drop-notifier-server.vercel.app",e=document.getElementById("price-drop-widget-root");if(!e)return;e.innerHTML=`
      <div class="form-container">
        <button id="price-drop-toggle-btn" class="toggle" aria-expanded="false">
            <span id="price-drop-toggle-text">Email me if this product gets cheaper</span>
        </button>

        <div id="price-drop-panel" class="panel">
            <form id="price-drop-form">
                <input type="email" name="widget_email" placeholder="you@example.com" required />
                <button type="submit">Notify me</button>
                <p id="price-drop-error-msg" class="error" style="display: none;">Something went wrong</p>
                <p id="price-drop-success-msg" class="success" style="display: none;">You will be notified!</p>
                <p id="price-drop-loading" class="loading" style="display: none;"></p>
            </form>
        </div>
    </div>
    `;let i=document.getElementById("price-drop-toggle-btn"),m=document.getElementById("price-drop-toggle-text"),u=document.getElementById("price-drop-panel"),p=document.getElementById("price-drop-form"),o=document.getElementById("price-drop-error-msg"),a=document.getElementById("price-drop-success-msg"),c=document.getElementById("price-drop-loading"),n=document.createElement("input");n.type="hidden",n.name="userscript_product",n.id="userscript_product_input",p.appendChild(n),i.addEventListener("click",()=>{let t=!(i.getAttribute("aria-expanded")==="true");i.setAttribute("aria-expanded",t),m.textContent=t?"Hide":"Email me if this product gets cheaper",u.classList.toggle("open",t)}),p.addEventListener("submit",async r=>{r.preventDefault(),r.stopPropagation(),o.style.display="none",a.style.display="none",c.style.display="block";let t=new FormData(r.target);console.log("formData:",t);let l={email:t.get("widget_email"),product:JSON.parse(t.get("userscript_product"))};console.log("payload:",l);try{let s=await fetch(`${d}/subscribe-price-drop`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(s.ok)a.style.display="block",p.reset();else if(s.status===409)o.style.display="block",o.textContent="You are already registered";else throw new Error("Server error")}catch(s){console.error("Widget Error:",s),o.style.display="block",o.textContent="Something went wrong. Please try again."}finally{c.style.display="none"}})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g()});return E();})();
