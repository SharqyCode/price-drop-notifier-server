var PriceDropWidget = (() => {
    var f = (i, e) => () => (e || i((e = { exports: {} }).exports, e), e.exports); var h = f(() => {
        var g = () => {
            let i = "https://price-drop-notifier-server.vercel.app", e = document.getElementById("price-drop-widget-root"); if (!e) return; e.innerHTML = `
      <div class="form-container">
        <button id="price-drop-toggle-btn" class="toggle" aria-expanded="false">
            <span id="price-drop-toggle-text">Email me if this product gets cheaper</span>
        </button>

        <div id="price-drop-panel" class="panel">
            <form id="price-drop-form">
                <input type="email" name="widget_email" placeholder="you@example.com" required />
                <button type="submit">Notify me</button>
                <p id="price-drop-error-msg" class="error" style="display: none;">Something went wrong</p>
                <p id="price-drop-success-msg" class="success" style="display: none;">You will be notified!</p>
                <p id="price-drop-loading" class="loading" style="display: none;"></p>
            </form>
        </div>
    </div>
    `; let d = document.getElementById("price-drop-toggle-btn"), m = document.getElementById("price-drop-toggle-text"), y = document.getElementById("price-drop-panel"), c = document.getElementById("price-drop-form"), r = document.getElementById("price-drop-error-msg"), p = document.getElementById("price-drop-success-msg"), a = document.getElementById("price-drop-loading"), n = document.createElement("input"); n.type = "hidden", n.name = "userscript_product", n.id = "userscript_product_input", c.appendChild(n), d.addEventListener("click", () => { let t = !(d.getAttribute("aria-expanded") === "true"); d.setAttribute("aria-expanded", t), m.textContent = t ? "Hide" : "Email me if this product gets cheaper", y.classList.toggle("open", t) }), c.addEventListener("submit", async s => { s.preventDefault(), s.stopPropagation(), r.style.display = "none", p.style.display = "none", a.style.display = "block"; let t = new FormData(s.target), l = t.get("widget_email"), u = t.get("userscript_product") || { name: document.querySelector("#productTitle")?.innerText.trim(), price: document.querySelector(".a-price .a-offscreen")?.innerText, url: window.location.href }; console.log({ email: l, userscript_product: u }); try { let o = await fetch(`${i}/subscribe-price-drop`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ widget_email: l, userscript_product: u }) }); if (o.ok) p.style.display = "block", c.reset(); else if (o.status === 409) r.style.display = "block", r.textContent = "You are already registered"; else throw new Error("Server error") } catch (o) { console.error("Widget Error:", o); let E = new CustomEvent("widget-failed", { detail: { reason: o.message, type: "CSP_OR_NETWORK" } }); window.dispatchEvent(E), console.error("Widget Error:", o), r.style.display = "block", r.textContent = "Something went wrong. Please try again." } finally { a.style.display = "none" } })
        }; document.readyState === "loading" ? document.addEventListener("DOMContentLoaded", g) : g()
    }); return h();
})();
